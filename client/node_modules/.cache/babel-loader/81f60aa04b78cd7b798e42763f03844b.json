{"ast":null,"code":"var _jsxFileName = \"G:\\\\projects\\\\entertain-me-redux\\\\client\\\\src\\\\pages\\\\Profile.js\",\n    _s = $RefreshSig$();\n\nimport { Redirect, useParams } from \"react-router-dom\";\nimport { ADD_FRIEND, REMOVE_MOVIE, REMOVE_TV_SHOW, REMOVE_GAME } from \"../utils/mutations\";\nimport { QUERY_SELF, QUERY_USER } from \"../utils/queries\";\nimport { useQuery, useMutation } from \"@apollo/client\";\nimport { Container, CardColumns, Card, Button } from \"react-bootstrap\";\nimport { removeMediaId } from \"../utils/saveMedia\";\nimport Auth from \"../utils/auth\";\nimport decode from \"jwt-decode\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Profile = props => {\n  _s();\n\n  const token = Auth.loggedIn() ? Auth.retrieveToken() : null;\n  const user = decode(token);\n  const username = user.data.username;\n  const [addFriend] = useMutation(ADD_FRIEND);\n  const [deleteContent] = useMutation(REMOVE_MOVIE, REMOVE_TV_SHOW, REMOVE_GAME);\n  const {\n    loading,\n    data\n  } = useQuery(user.data.username ? QUERY_SELF : QUERY_USER);\n  const userData = (data === null || data === void 0 ? void 0 : data.me) || (data === null || data === void 0 ? void 0 : data.user) || {};\n\n  if (Auth.loggedIn() && Auth.getUserData().username === user.data.username) {\n    return /*#__PURE__*/_jsxDEV(Redirect, {\n      to: \"/profile\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 33,\n      columnNumber: 12\n    }, this);\n  }\n\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 37,\n      columnNumber: 12\n    }, this);\n  }\n\n  if (!(userData === null || userData === void 0 ? void 0 : userData.username)) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"You need to be logged in to see this. Please select log in or sign up to view user profile page!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 43,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn-1\",\n        onClick: () => console.log(userData),\n        children: \"Click Me!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 47,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 42,\n      columnNumber: 7\n    }, this);\n  } // change the passed in value to something that can be unique to the content type ie. passed in value of mediaType and compare to favorite media array on user model\n\n\n  const handleDeleteContent = async () => {\n    const token = Auth.loggedIn() ? Auth.getToken() : null; // const { data } = useQuery(userParam ? QUERY_SELF : QUERY_USER, {\n    //   variables: { username: userParam },\n    // });\n\n    const movieId = (data === null || data === void 0 ? void 0 : data.me.favoriteMovies.movieId) || (data === null || data === void 0 ? void 0 : data.user.favoriteMovies.movieId);\n    const tvShowId = (data === null || data === void 0 ? void 0 : data.me.favoriteTvShows.tvShowId) || (data === null || data === void 0 ? void 0 : data.user.favoriteTvShows.tvShowId);\n    const gameId = (data === null || data === void 0 ? void 0 : data.me.favoriteGames.gameId) || (data === null || data === void 0 ? void 0 : data.user.favoriteGames.gameId);\n\n    if (!token) {\n      return false;\n    }\n\n    if (movieId) {\n      await deleteContent({\n        variables: {\n          movieId: movieId\n        },\n        update: cache => {\n          const data = cache.readQuery({\n            query: QUERY_SELF\n          });\n          const userDataCache = data.me;\n          const savedMovieCache = userDataCache.favoriteMovies;\n          const updatedMoviesCache = savedMovieCache.filter(movie => movie.movieId !== movieId);\n          data.me.favoriteMovies = updatedMoviesCache;\n          cache.writeQuery({\n            query: QUERY_SELF,\n            data: {\n              data: { ...data.me.favoriteMovies\n              }\n            }\n          });\n        }\n      });\n      removeMediaId(movieId);\n    }\n\n    if (tvShowId) {\n      await deleteContent({\n        variables: {\n          tvShowId: tvShowId\n        },\n        update: cache => {\n          const data = cache.readQuery({\n            query: QUERY_SELF\n          });\n          const userDataCache = data.me;\n          const savedTvShowCache = userDataCache.favoriteTvShows;\n          const updatedTvShowCache = savedTvShowCache.filter(tv => tv.tvShowId !== tvShowId);\n          data.me.favoriteTvShows = updatedTvShowCache;\n          cache.writeQuery({\n            query: QUERY_SELF,\n            data: {\n              data: { ...data.me.favoriteTvShows\n              }\n            }\n          });\n        }\n      });\n      removeMediaId(tvShowId);\n    }\n\n    if (gameId) {\n      await deleteContent({\n        variables: {\n          gameId: gameId\n        },\n        update: cache => {\n          const data = cache.readQuery({\n            query: QUERY_SELF\n          });\n          const userDataCache = data.me;\n          const savedGameCache = userDataCache.favoriteGames;\n          const updatedGamesCache = savedGameCache.filter(game => game.gameId !== gameId);\n          data.me.favoriteGames = updatedGamesCache;\n          cache.writeQuery({\n            query: QUERY_SELF,\n            data: {\n              data: { ...data.me.favoriteGames\n              }\n            }\n          });\n        }\n      });\n      removeMediaId(gameId);\n    }\n  };\n\n  const handleClick = async () => {\n    try {\n      await addFriend({\n        variables: {\n          id: userData._id\n        }\n      });\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 12\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      fluid: true,\n      className: \"text-light bg-dark\",\n      children: /*#__PURE__*/_jsxDEV(Container, {\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: [`${userData.username}'s`, \" Profile\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 11\n        }, this), user.data.username && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn\",\n          onClick: handleClick,\n          children: \"Add Friend\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Container, {\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: userData.favoriteMovies.length ? `Viewing ${userData.favoriteMovies.length} saved ${userData.favoriteMovies.length === 1 ? \"movie\" : \"movies\"}:` : \"You have no saved movies!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(CardColumns, {\n        children: userData.favoriteMovies.map(user => {\n          return /*#__PURE__*/_jsxDEV(Card, {\n            border: \"dark\",\n            children: [user.moviePoster ? /*#__PURE__*/_jsxDEV(Card.Img, {\n              src: user.moviePoster,\n              alt: `The cover for ${user.movieName}`,\n              variant: \"top\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 169,\n              columnNumber: 19\n            }, this) : null, /*#__PURE__*/_jsxDEV(Card.Body, {\n              children: [/*#__PURE__*/_jsxDEV(Card.Title, {\n                children: user.movieName\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 176,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Card.Text, {\n                children: user.movieDetails\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 177,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                className: \"btn-block btn-danger\",\n                onClick: () => handleDeleteContent(user.movieId),\n                children: \"Delete this Movie!\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 178,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 175,\n              columnNumber: 17\n            }, this)]\n          }, user.movieId, true, {\n            fileName: _jsxFileName,\n            lineNumber: 167,\n            columnNumber: 15\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Container, {\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: userData.favoriteTvShows.length ? `Viewing ${userData.favoriteTvShows.length} saved ${userData.favoriteTvShows.length === 1 ? \"tv show\" : \"tv shows\"}:` : \"You have no saved Tv Shows!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(CardColumns, {\n        children: userData.favoriteTvShows.map(user => {\n          return /*#__PURE__*/_jsxDEV(Card, {\n            border: \"dark\",\n            children: [user.tvShowPoster ? /*#__PURE__*/_jsxDEV(Card.Img, {\n              src: user.tvShowPoster,\n              alt: `The cover for ${user.tvShowName}`,\n              variant: \"top\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 203,\n              columnNumber: 19\n            }, this) : null, /*#__PURE__*/_jsxDEV(Card.Body, {\n              children: [/*#__PURE__*/_jsxDEV(Card.Title, {\n                children: user.tvShowName\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 210,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Card.Text, {\n                children: user.tvShowDetails\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 211,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                className: \"btn-block btn-danger\",\n                onClick: () => handleDeleteContent(user.tvShowId),\n                children: \"Delete this Tv Show!\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 212,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 209,\n              columnNumber: 17\n            }, this)]\n          }, user.tvShowId, true, {\n            fileName: _jsxFileName,\n            lineNumber: 201,\n            columnNumber: 15\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Container, {\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: userData.favoriteGames.length ? `Viewing ${userData.favoriteGames.length} saved ${userData.favoriteGames.length === 1 ? \"game\" : \"games\"}:` : \"You have no saved Games!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(CardColumns, {\n        children: userData.favoriteGames.map(user => {\n          return /*#__PURE__*/_jsxDEV(Card, {\n            border: \"dark\",\n            children: [user.gamePoster ? /*#__PURE__*/_jsxDEV(Card.Img, {\n              src: user.gamePoster,\n              alt: `The cover for ${user.gameName}`,\n              variant: \"top\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 237,\n              columnNumber: 19\n            }, this) : null, /*#__PURE__*/_jsxDEV(Card.Body, {\n              children: [/*#__PURE__*/_jsxDEV(Card.Title, {\n                children: user.gameName\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 244,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Card.Text, {\n                children: user.gameDetails\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 245,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                className: \"btn-block btn-danger\",\n                onClick: () => handleDeleteContent(user.gameId),\n                children: \"Delete this Game!\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 246,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 243,\n              columnNumber: 17\n            }, this)]\n          }, user.gameId, true, {\n            fileName: _jsxFileName,\n            lineNumber: 235,\n            columnNumber: 15\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n\n_s(Profile, \"MDPuozBGV9J+AqdL4pkZchhVDPE=\", false, function () {\n  return [useMutation, useMutation, useQuery];\n});\n\n_c = Profile;\nexport default Profile;\n\nvar _c;\n\n$RefreshReg$(_c, \"Profile\");","map":{"version":3,"sources":["G:/projects/entertain-me-redux/client/src/pages/Profile.js"],"names":["Redirect","useParams","ADD_FRIEND","REMOVE_MOVIE","REMOVE_TV_SHOW","REMOVE_GAME","QUERY_SELF","QUERY_USER","useQuery","useMutation","Container","CardColumns","Card","Button","removeMediaId","Auth","decode","Profile","props","token","loggedIn","retrieveToken","user","username","data","addFriend","deleteContent","loading","userData","me","getUserData","console","log","handleDeleteContent","getToken","movieId","favoriteMovies","tvShowId","favoriteTvShows","gameId","favoriteGames","variables","update","cache","readQuery","query","userDataCache","savedMovieCache","updatedMoviesCache","filter","movie","writeQuery","savedTvShowCache","updatedTvShowCache","tv","savedGameCache","updatedGamesCache","game","handleClick","id","_id","err","error","length","map","moviePoster","movieName","movieDetails","tvShowPoster","tvShowName","tvShowDetails","gamePoster","gameName","gameDetails"],"mappings":"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","sourcesContent":["import { Redirect, useParams } from \"react-router-dom\";\nimport {\n  ADD_FRIEND,\n  REMOVE_MOVIE,\n  REMOVE_TV_SHOW,\n  REMOVE_GAME,\n} from \"../utils/mutations\";\nimport { QUERY_SELF, QUERY_USER } from \"../utils/queries\";\nimport { useQuery, useMutation } from \"@apollo/client\";\nimport { Container, CardColumns, Card, Button } from \"react-bootstrap\";\nimport { removeMediaId } from \"../utils/saveMedia\";\nimport Auth from \"../utils/auth\";\nimport decode from \"jwt-decode\";\n\nconst Profile = (props) => {\n  const token = Auth.loggedIn() ? Auth.retrieveToken() : null;\n  const user = decode(token);\n  const username = user.data.username;\n\n  const [addFriend] = useMutation(ADD_FRIEND);\n  const [deleteContent] = useMutation(\n    REMOVE_MOVIE,\n    REMOVE_TV_SHOW,\n    REMOVE_GAME\n  );\n  const { loading, data } = useQuery(\n    user.data.username ? QUERY_SELF : QUERY_USER\n  );\n\n  const userData = data?.me || data?.user || {};\n\n  if (Auth.loggedIn() && Auth.getUserData().username === user.data.username) {\n    return <Redirect to=\"/profile\" />;\n  }\n\n  if (loading) {\n    return <div>Loading...</div>;\n  }\n\n  if (!userData?.username) {\n    return (\n      <div>\n        <h4>\n          You need to be logged in to see this. Please select log in or sign up\n          to view user profile page!\n        </h4>\n        <button className=\"btn-1\" onClick={() => console.log(userData)}>\n          Click Me!\n        </button>\n      </div>\n    );\n  }\n  // change the passed in value to something that can be unique to the content type ie. passed in value of mediaType and compare to favorite media array on user model\n  const handleDeleteContent = async () => {\n    const token = Auth.loggedIn() ? Auth.getToken() : null;\n    // const { data } = useQuery(userParam ? QUERY_SELF : QUERY_USER, {\n    //   variables: { username: userParam },\n    // });\n\n    const movieId =\n      data?.me.favoriteMovies.movieId || data?.user.favoriteMovies.movieId;\n    const tvShowId =\n      data?.me.favoriteTvShows.tvShowId || data?.user.favoriteTvShows.tvShowId;\n    const gameId =\n      data?.me.favoriteGames.gameId || data?.user.favoriteGames.gameId;\n\n    if (!token) {\n      return false;\n    }\n\n    if (movieId) {\n      await deleteContent({\n        variables: { movieId: movieId },\n        update: (cache) => {\n          const data = cache.readQuery({ query: QUERY_SELF });\n          const userDataCache = data.me;\n          const savedMovieCache = userDataCache.favoriteMovies;\n          const updatedMoviesCache = savedMovieCache.filter(\n            (movie) => movie.movieId !== movieId\n          );\n          data.me.favoriteMovies = updatedMoviesCache;\n          cache.writeQuery({\n            query: QUERY_SELF,\n            data: { data: { ...data.me.favoriteMovies } },\n          });\n        },\n      });\n      removeMediaId(movieId);\n    }\n    if (tvShowId) {\n      await deleteContent({\n        variables: { tvShowId: tvShowId },\n        update: (cache) => {\n          const data = cache.readQuery({ query: QUERY_SELF });\n          const userDataCache = data.me;\n          const savedTvShowCache = userDataCache.favoriteTvShows;\n          const updatedTvShowCache = savedTvShowCache.filter(\n            (tv) => tv.tvShowId !== tvShowId\n          );\n          data.me.favoriteTvShows = updatedTvShowCache;\n          cache.writeQuery({\n            query: QUERY_SELF,\n            data: { data: { ...data.me.favoriteTvShows } },\n          });\n        },\n      });\n      removeMediaId(tvShowId);\n    }\n    if (gameId) {\n      await deleteContent({\n        variables: { gameId: gameId },\n        update: (cache) => {\n          const data = cache.readQuery({ query: QUERY_SELF });\n          const userDataCache = data.me;\n          const savedGameCache = userDataCache.favoriteGames;\n          const updatedGamesCache = savedGameCache.filter(\n            (game) => game.gameId !== gameId\n          );\n          data.me.favoriteGames = updatedGamesCache;\n          cache.writeQuery({\n            query: QUERY_SELF,\n            data: { data: { ...data.me.favoriteGames } },\n          });\n        },\n      });\n      removeMediaId(gameId);\n    }\n  };\n\n  const handleClick = async () => {\n    try {\n      await addFriend({\n        variables: { id: userData._id },\n      });\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  if (loading) {\n    return <h2>Loading...</h2>;\n  }\n\n  return (\n    <>\n      <div fluid className=\"text-light bg-dark\">\n        <Container>\n          <h2>{`${userData.username}'s`} Profile</h2>\n          {user.data.username && (\n            <button className=\"btn\" onClick={handleClick}>\n              Add Friend\n            </button>\n          )}\n        </Container>\n      </div>\n      <Container>\n        <h2>\n          {userData.favoriteMovies.length\n            ? `Viewing ${userData.favoriteMovies.length} saved ${\n                userData.favoriteMovies.length === 1 ? \"movie\" : \"movies\"\n              }:`\n            : \"You have no saved movies!\"}\n        </h2>\n        <CardColumns>\n          {userData.favoriteMovies.map((user) => {\n            return (\n              <Card key={user.movieId} border=\"dark\">\n                {user.moviePoster ? (\n                  <Card.Img\n                    src={user.moviePoster}\n                    alt={`The cover for ${user.movieName}`}\n                    variant=\"top\"\n                  />\n                ) : null}\n                <Card.Body>\n                  <Card.Title>{user.movieName}</Card.Title>\n                  <Card.Text>{user.movieDetails}</Card.Text>\n                  <Button\n                    className=\"btn-block btn-danger\"\n                    onClick={() => handleDeleteContent(user.movieId)}\n                  >\n                    Delete this Movie!\n                  </Button>\n                </Card.Body>\n              </Card>\n            );\n          })}\n        </CardColumns>\n      </Container>\n      <Container>\n        <h2>\n          {userData.favoriteTvShows.length\n            ? `Viewing ${userData.favoriteTvShows.length} saved ${\n                userData.favoriteTvShows.length === 1 ? \"tv show\" : \"tv shows\"\n              }:`\n            : \"You have no saved Tv Shows!\"}\n        </h2>\n        <CardColumns>\n          {userData.favoriteTvShows.map((user) => {\n            return (\n              <Card key={user.tvShowId} border=\"dark\">\n                {user.tvShowPoster ? (\n                  <Card.Img\n                    src={user.tvShowPoster}\n                    alt={`The cover for ${user.tvShowName}`}\n                    variant=\"top\"\n                  />\n                ) : null}\n                <Card.Body>\n                  <Card.Title>{user.tvShowName}</Card.Title>\n                  <Card.Text>{user.tvShowDetails}</Card.Text>\n                  <Button\n                    className=\"btn-block btn-danger\"\n                    onClick={() => handleDeleteContent(user.tvShowId)}\n                  >\n                    Delete this Tv Show!\n                  </Button>\n                </Card.Body>\n              </Card>\n            );\n          })}\n        </CardColumns>\n      </Container>\n      <Container>\n        <h2>\n          {userData.favoriteGames.length\n            ? `Viewing ${userData.favoriteGames.length} saved ${\n                userData.favoriteGames.length === 1 ? \"game\" : \"games\"\n              }:`\n            : \"You have no saved Games!\"}\n        </h2>\n        <CardColumns>\n          {userData.favoriteGames.map((user) => {\n            return (\n              <Card key={user.gameId} border=\"dark\">\n                {user.gamePoster ? (\n                  <Card.Img\n                    src={user.gamePoster}\n                    alt={`The cover for ${user.gameName}`}\n                    variant=\"top\"\n                  />\n                ) : null}\n                <Card.Body>\n                  <Card.Title>{user.gameName}</Card.Title>\n                  <Card.Text>{user.gameDetails}</Card.Text>\n                  <Button\n                    className=\"btn-block btn-danger\"\n                    onClick={() => handleDeleteContent(user.gameId)}\n                  >\n                    Delete this Game!\n                  </Button>\n                </Card.Body>\n              </Card>\n            );\n          })}\n        </CardColumns>\n      </Container>\n    </>\n  );\n};\n\nexport default Profile;\n"]},"metadata":{},"sourceType":"module"}